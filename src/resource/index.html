<!doctype html>
<html>
<head>
<title>CmdFreak</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="pragma" content="non-cache" />
<meta http-equiv="cache-control" content="non-cache" />
<meta http-equiv="expires" content="0" />
<link rel="stylesheet" href="./lib/jquery/jquery-ui.min.css" />
<script src="./lib/jquery/jquery-1.9.1.min.js"></script>
<script src="./lib/jquery/jquery-ui.min.js"></script>
<link rel="stylesheet" href="./lib/grid/pqgrid.min.css" />
<script src="./lib/grid/pqgrid.min.js"></script>
<link rel="stylesheet" href="./lib/grid/themes/office/pqgrid.css" />
<link rel="stylesheet" href="./style.css" />

<script type="text/javascript">

var currentTablename = "";
var currentDbmsname = "";
var welcomeDlg = true;

var myLanguage = 0;

///////////////////////////////////////////////
// Tool Bar
var CLIMSG_LABEL_ODBCCONNECTION    = 2101;
var CLIMSG_LABEL_TABLEINFO         = 2102;
var CLIMSG_LABEL_REFRSHTABLE       = 2103;
var CLIMSG_LABEL_FILTERING         = 2104;
var CLIMSG_LABEL_INFORMATION       = 2105;
///////////////////////////////////////////////
// Info
var CLIMSG_LABEL_LOGTIME           = 2130;
var CLIMSG_LABEL_LOGMSG            = 2131;
var CLIMSG_TECH_EMBEDDED           = 2132;
var CLIMSG_OPEN_MANUAL             = 2133;
var CLIMSG_OPEN_MANUAL_URL         = 2134;
var CLIMSG_TRACELOG                = 2135;
///////////////////////////////////////////////
// ODBC Config
var CLIMSG_ODBCCONNSTR_GUIDE       = 2140;
var CLIMSG_ODBCSELECTION           = 2142;
var CLIMSG_ODBCCONNSTR_SPECIFY     = 2143;
var CLIMSG_ODBCCONFAILURE          = 2144;
///////////////////////////////////////////////
// Table Info
var CLIMSG_TABLEINFOSHOWN          = 2160;
var CLIMSG_LABEL_TARGETTABLE       = 2161;
var CLIMSG_TABLENOTEXIST           = 2162;
///////////////////////////////////////////////
// Filtering
var CLIMSG_FILTERING_DESC          = 2170;
var CLIMSG_FILTERING_NO_TABLE      = 2171;
var CLIMSG_FILTERING_UNSPECIFY     = 2172;
var CLIMSG_FILTERING_INVALID       = 2173;
///////////////////////////////////////////////
// Basic
var CLIMSG_FAITALERROR             = 2500;
var CLIMSG_WARNING                 = 2501;
var CLIMSG_ERROR                   = 2502;
///////////////////////////////////////////////
// Uncategorized
var CLIMSG_WAITFORAWHILE           = 2510;
var CLIMSG_WELCOME                 = 2511;
var CLIMSG_WELCOME_CONFIGODBC      = 2512;
var CLIMSG_SERVER_ERROR            = 2520;
var CLIMSG_COMMUNICATIONERROR      = 2530;

var cliMsg = [
              ///////////////////////////////////////////////
              // Tool Bar
              {'code':CLIMSG_LABEL_ODBCCONNECTION, 'en':'ODBC Connections', 'ja':'ODBC接続'},
              {'code':CLIMSG_LABEL_TABLEINFO, 'en':'Table Information', 'ja':'テーブル情報'},
              {'code':CLIMSG_LABEL_REFRSHTABLE, 'en':'Refresh Table List', 'ja':'テーブル一覧更新'},
              {'code':CLIMSG_LABEL_FILTERING, 'en':'Filtering', 'ja':'フィルタリング'},
              {'code':CLIMSG_LABEL_INFORMATION, 'en':'Information', 'ja':'情報'},
              ///////////////////////////////////////////////
              // Info
              {'code':CLIMSG_LABEL_LOGTIME, 'en':'Logging time', 'ja':'ログ出力時刻'},
              {'code':CLIMSG_LABEL_LOGMSG, 'en':'Message', 'ja':'メッセージ'},
              {'code':CLIMSG_TECH_EMBEDDED, 'en':'This software has the following technologies embedded:', 'ja':'このソフトウェアは次の技術を取り込んでいます。'},
              {'code':CLIMSG_OPEN_MANUAL, 'en':'Open online manual', 'ja':'オンラインマニュアルを開く'},
              {'code':CLIMSG_OPEN_MANUAL_URL, 'en':'manual/eng/index.htm', 'ja':'manual/jpn/index.htm'},
              {'code':CLIMSG_TRACELOG, 
                  'en':'The trace log is displayed below.<br>Times are as per the time zone of the web server\'s location.', 
                  'ja':'以下にトレースログが表示されます。<br>表示される時刻はWebサーバーが配置された地域の時刻となります。'
              },
              ///////////////////////////////////////////////
              // ODBC Config
              {'code':CLIMSG_ODBCCONNSTR_GUIDE,
                  'en':'Configure ODBC connection.<br>Select the connection target DBMS and specify the ODBC connection string.<br>As this is 32-bit application software, this string should be specified for the use of a 32-bit ODBC driver. As a prerequisite, a 32-bit ODBC driver needs to be installed on the operating system.<br>',
                  'ja':'ODBC接続の設定を行います。<br>接続対象のDBMSを選択し，ODBCの接続文字列を指定してください。<br>本ソフトウェアは32ビットアプリケーションのため，ODBC接続文字列には，32ビット版ODBCドライバを使用するように指定を行ってください。オペレーティングシステムには，あらかじめ32ビット版ODBCドライバがインストールされている必要があります。<br>'
              },
              {'code':CLIMSG_ODBCSELECTION, 'en':'Select DBMS : ', 'ja':'DBMSの選択 : '},
              {'code':CLIMSG_ODBCCONNSTR_SPECIFY, 'en':'Specify connection string : <br/>', 'ja':'接続文字列の指定 : <br/>'},
              {'code':CLIMSG_ODBCCONFAILURE,
                  'en':'DBMS connection failed.<br>This may be caused by one of the following issues:<br>- The DBMS is not working properly.<br>- No ODBC driver is installed.<br>- The ODBC connection string is invalid.<br>- There are issues with the DBMS on the network.<br>',
                  'ja':'DBMSとの接続に失敗しました。<br>次の要因が考えられます。<br>- DBMSが適切に起動していない。<br>- ODBCドライバがインストールされていない。<br>- ODBCの接続文字列が不正。<br>- DBMSとの接続経路に何らかの問題がある。<br>'
              },
              ///////////////////////////////////////////////
              // Table Info
              {'code':CLIMSG_TABLEINFOSHOWN, 'en':'Detailed information on the specified table is shown below.', 'ja':'以下に指定されたテーブルの詳細情報を表示します。'},
              {'code':CLIMSG_LABEL_TARGETTABLE, 'en':'The target table: ', 'ja':'対象テーブル: '},
              {'code':CLIMSG_TABLENOTEXIST, 'en':'The operation cannot be performed because the target table for display does not exist.', 'ja':'表示対象のテーブルが存在しないため操作を継続できません。'},
              ///////////////////////////////////////////////
              // Filtering
              {'code':CLIMSG_FILTERING_DESC,
                  'en':'Filter settings can be specified here.<br>Records are filtered according to the specified criteria.<br>Up to five filter items can be specified.<br>All items are treated as logical AND operators.',
                  'ja':'ここではフィルタリングの設定を行うことができます。<br>指定した条件でレコード情報がフィルタリングされます。<br>フィルタリング項目は最大5件を指定することができます。<br>各フィルタリング項目間は論理積[AND]で結合されます。'
              },
              {'code':CLIMSG_FILTERING_NO_TABLE, 'en':'The operation cannot be performed because the target table for filtering does not exist.', 'ja':'フィルタリングの対象となるテーブルが存在しないため操作を継続できません。'},
              {'code':CLIMSG_FILTERING_UNSPECIFY, 'en':'Unspecified', 'ja':'未指定'},
              {'code':CLIMSG_FILTERING_INVALID,
                  'en':'The filter conditions set do not match the current table schema.<br>Do you want to clear the filter conditions?',
                  'ja':'設定されているフィルタリング条件は現在のテーブルのスキーマと一致していません。<br>フィルタリング条件をクリアしてよいですか？'
              },
              ///////////////////////////////////////////////
              // Basic
              {'code':CLIMSG_FAITALERROR, 'en':'Fatal Error', 'ja':'致命的エラー'},
              {'code':CLIMSG_WARNING, 'en':'Warning', 'ja':'警告'},
              {'code':CLIMSG_ERROR, 'en':'Error', 'ja':'エラー'},
              {'code':CLIMSG_WAITFORAWHILE, 'en':'Now loading... Please wait for a while.', 'ja':'読み込み中です。しばらくお待ちください。'},
              {'code':CLIMSG_WELCOME, 'en':'Welcome to the CmdFreak page!', 'ja':'ようこそ，CmdFreakのページです！'},
              {'code':CLIMSG_WELCOME_CONFIGODBC,
                  'en':'To refer to data in a database using this software, the ODBC connection needs to be configured first.',
                  'ja':'本ソフトウェアを使用してデータベースのデータを参照するには，まずはじめにODBC接続の設定を行ってください。'
              },
              {'code':CLIMSG_SERVER_ERROR, 'en':'An error occurred at server side.', 'ja':'サーバ側でエラーが発生しました。'},
              {'code':CLIMSG_COMMUNICATIONERROR,
                  'en':'Connection with CmdFreak service failed. This may be caused by one of the following issues:<br>(1) CmdFreak service cannot be started.<br>(2) CmdFreak service is not registered as a firewall exception.<br>(3) The definition file [nginx.conf and/or stkwebapp.conf] for the host name and port number in the network connectivity settings is invalid.<br>(4) A CmdFreak internal process is invalid.<br>',
                  'ja':'CmdFreakサービスとの通信が失敗しました。次の要因が考えられます。<br>(1) CmdFreakサービスが開始されていない。<br>(2) CmdFreakサービスがファイアウォールに例外登録されていない。<br>(3) 接続先ホスト名およびポート番号の定義ファイル [nginx.conf , stkwebapp.conf] が不正。<br>(4) CmdFreakの内部処理で異常が発生している。<br>'
              }
];

var ACTION_LAUNCH           = 50;
var ACTION_GETTABLEINFO     = 60;
var ACTION_GETODBCCONNSTR   = 100;
var ACTION_POSTODBCCONNSTR  = 101;
var ACTION_DISPLAYDBMSTYPE  = 110;
var ACTION_SHOWTABLEINFO    = 200;
var ACTION_GETFILTERINFO    = 300;
var ACTION_POSTFILTERINFO   = 301;
var ACTION_GETFILTERSW      = 310;
var ACTION_TURNFILTERSWON   = 320;
var ACTION_TURNFILTERSWOFF  = 330;
var ACTION_REFRESH          = 400;
var ACTION_SHOWTABLE        = 500;
var ACTION_INFO             = 600;
var ACTION_ERROR            = 1200;

var API_GET_LANGUAGE            = 0;
var API_GET_SYSTEM              = 1;
var API_GET_LOGS                = 2;
var API_GET_TABLEINFO           = 3;
var API_GET_TABLEINFO_WITH_COL  = 4;
var API_GET_ODBCINFO_DEFAULT    = 5;
var API_GET_ODBCINFO_CONFIGURED = 6;
var API_POST_ODBCINFO           = 7;
var API_GET_RECORDS             = 8;
var API_GET_FILTERINFO          = 9;
var API_POST_FILTERINFO         = 10;

// underComm = 0 : No communication state, >= 1 : Communication state
var underComm = 0;

// [0] : for API_GET_LANGUAGE, [1] : for API_GET_SYSTEM, [2] : for API_GET_LOGS, ...
var statusCode = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
var responseData = [{},{},{},{},{},{},{},{},{},{},{},{},{},{}];

window.onload = function() {
    $('#adialog').dialog({autoOpen:false});
    $('#wdialog').dialog({autoOpen:false});

    onXxxAction(ACTION_LAUNCH);

    // Steps below is required in case no connection with server is established.
    // If following steps are not presented, a connection error dialog is displayed on the layout broken page.
    displaySheet();
    boxResize();
    document.getElementById('mainarea').style.display='block';
}

function refreshMainScreen()
{
    displaySheet();
    boxResize();
    document.getElementById('mainarea').style.display='block';
    showTableWithToolBar();
}

function getCliMsg(msgCode) {
    for (var loop = 0; loop < cliMsg.length; loop++) {
        var currentIt = cliMsg[loop];
        if (currentIt.code == msgCode) {
            if (myLanguage == 1) {
                return currentIt.ja;
            } else {
                return currentIt.en;
            }
        }
    }
}

function getSvrMsg(respDat) {
    if (myLanguage == 1) {
        return getCliMsg(CLIMSG_SERVER_ERROR) + '<br/>' + respDat.MsgJpn;
    } else {
        return getCliMsg(CLIMSG_SERVER_ERROR) + '<br/>' + respDat.MsgEng;
    }
}

function boxResize() {
    var box_info = document.getElementById('box_info');
    var box_cont = document.getElementById('container');
    var boxHeight = getshowHeight();
    var boxWidth  = getshowWidth();
    if (boxHeight < 440) {
        boxHeight = 440;
    }
    if (boxWidth < 580) {
        boxWidth = 580;
    }
    box_info.style.height = boxHeight - 20 + 'px';
    box_info.style.width  = boxWidth  + 'px';
    box_cont.style.height = boxHeight + 'px';
    box_cont.style.width  = boxWidth  + 'px';
    $(function () {
        $('#grid_array').pqGrid('option', 'width', boxWidth - 2);
        $('#grid_array').pqGrid('option', 'height', boxHeight - 62);
    });
}

function getshowHeight() {
    if (window.innerHeight)
        return window.innerHeight;
    if (document.body.parentNode.clientHeight)
        return document.body.parentNode.clientHeight;
    if (document.body.clientHeight)
        return document.body.clientHeight;
}

function getshowWidth() {
    if (window.innerWidth)
        return window.innerWidth;
    if (document.body.parentNode.clientWidth)
        return document.body.parentNode.clientWidth;
    if (document.body.clientWidth)
        return document.body.clientWidth;
}

function showTableWithToolBar() {
    $('#mainarea').empty();
    var buttons = [
        ['mainarea', 'img/config_image32s.png', 'img/config_image32c.png', getCliMsg(CLIMSG_LABEL_ODBCCONNECTION), ACTION_GETODBCCONNSTR],
        ['mainarea', 'img/sep32.png', 'img/sep32.png', '', -1],
        ['mainarea', 'img/table_image32s.png', 'img/table_image32c.png', getCliMsg(CLIMSG_LABEL_TABLEINFO), ACTION_SHOWTABLEINFO],
        ['mainarea', 'img/refresh_image32s.png', 'img/refresh_image32c.png', getCliMsg(CLIMSG_LABEL_REFRSHTABLE), ACTION_REFRESH],
        ['mainarea', 'img/sep32.png', 'img/sep32.png', '', -1],
        ['mainarea', 'img/filter_image32s.png', 'img/filter_image32c.png', getCliMsg(CLIMSG_LABEL_FILTERING), ACTION_GETFILTERINFO],
        ['mainarea', 'img/sep32.png', 'img/sep32.png', '', -1],
        ['mainarea', 'img/info_image32s.png', 'img/info_image32c.png', getCliMsg(CLIMSG_LABEL_INFORMATION), ACTION_INFO]
    ];
    for (var Loop = 0; Loop < 8; Loop++) {
        displayButton(buttons[Loop][0], buttons[Loop][1], buttons[Loop][2], buttons[Loop][3], buttons[Loop][4]);
        if (Loop == 0) {
            $('#mainarea').append('<span id="dbmstypeontoolbar">' + currentDbmsname + '</span>');
            onXxxAction(ACTION_DISPLAYDBMSTYPE);
        }
        if (Loop == 2) {
            $('#mainarea').append('<select id="tableselector" style="width:150px" onchange="eventTableSelected()" align="middle">');
            $('#mainarea').append('</select>');
            refreshTableNameList();
        }
        if (Loop == 5) {
            $('#mainarea').append('<input type="checkbox" id="filteringonoff" value="filteringOn" align="middle" onclick="eventFilterOn(this)">On');
            onXxxAction(ACTION_GETFILTERSW);
        }
    }
    appendBr('mainarea');
}

function displayButton(target, mouseOutIcon, mouseOverIcon, toolTip, actionType) {
    var element = document.createElement('img');
    element.src=mouseOutIcon;
    element.border='0';
    element.align='middle';
    if (actionType != -1) {
        element.title=toolTip;
        element.style.cursor='hand';
        element.onmouseover = function(){
            element.src=mouseOverIcon;
        }
        element.onmouseout = function(){
            element.src=mouseOutIcon;
        }
        element.onclick = function(){
            onXxxAction(actionType);
        }
    }
    var parentElem = document.getElementById(target);
    parentElem.appendChild(element);
}

function appendBr(target) {
    var element = document.createElement('br');
    var parentElem = document.getElementById(target);
    parentElem.appendChild(element);
}

function displaySheet() {
    var obj = { width:300, height:300, title:'', resizable:false, draggable:false, freezeCols:0 };
    var data = [];
    obj.colModel = [{ title: '', width: 10, dataType: 'integer' }];
    obj.dataModel = { data: data, paging: 'local', rPPOptions:[100, 200, 400], rPP:100 };
    $('#grid_array').pqGrid(obj);
}

function closeWaitingDialogAndExecuteNextAction(actionType) {
    if (underComm == 0) {
        $('#wdialog').dialog('close');

        //
        //
        if (actionType == ACTION_LAUNCH) {
            if (statusCode[API_GET_LANGUAGE] == 200) {
                if (responseData[API_GET_LANGUAGE].Data.ClientLanguage == 'ja') {
                    myLanguage = 1;
                }
                refreshMainScreen();
            } else if (statusCode[API_GET_LANGUAGE] == 406) {
                showMessageDialog(getCliMsg(CLIMSG_WARNING), getSvrMsg(responseData[API_GET_LANGUAGE]), ACTION_ERROR, 512, 200, 'img/error_image48c.png', 0);
            } else {
                showMessageDialog(getCliMsg(CLIMSG_FAITALERROR), getCliMsg(CLIMSG_COMMUNICATIONERROR), ACTION_ERROR, 550, 280, 'img/error_image48c.png', 0);
            }
            return;
        }
        //
        //
        if (actionType == ACTION_GETTABLEINFO) {
            $('#tableselector').empty();

            if (statusCode[API_GET_TABLEINFO] == 200) {
                // Nothing to do
            } else {
                showMessageDialog(getCliMsg(CLIMSG_FAITALERROR), getCliMsg(CLIMSG_COMMUNICATIONERROR), ACTION_ERROR, 550, 280, 'img/error_image48c.png', 0);
                return;
            }

            var tableInfos = [];
            if (responseData[API_GET_TABLEINFO].Data.TableInfo instanceof Array) {
                tableInfos = responseData[API_GET_TABLEINFO].Data.TableInfo;
            } else if (responseData[API_GET_TABLEINFO].Data.TableInfo) {
                tableInfos.push(responseData[API_GET_TABLEINFO].Data.TableInfo);
            }
            for (var tableIndex = 0; tableIndex < tableInfos.length; tableIndex++) {
                var tn = tableInfos[tableIndex].Name;
                var tnReplaced = tn;
                tnReplaced = tnReplaced.replace(/&/g, "&amp;");
                tnReplaced = tnReplaced.replace(/</g, "&lt;");
                tnReplaced = tnReplaced.replace(/>/g, "&gt;");
                tnReplaced = tnReplaced.replace(/\"/g, "&quot;");
                var seld = '';
                if (tableIndex == 0 && currentTablename == "") {
                    currentTablename = tn;
                }
                if (tn == currentTablename) {
                    seld = 'selected';
                }
                $('#tableselector').append('<option value="' + tnReplaced + '" ' + seld + '>' + tnReplaced + '</option>');
            }

            initializeCurrentTablename();
            if (currentTablename !== "") {
                showTable();
            }

            return;
        }
        //
        //
        if (actionType == ACTION_GETODBCCONNSTR) {
            if (statusCode[API_GET_ODBCINFO_DEFAULT] == 200 && statusCode[API_GET_ODBCINFO_CONFIGURED] == 200) {
                // Nothing to do
            } else if (statusCode[API_GET_ODBCINFO_DEFAULT] == 400 || statusCode[API_GET_ODBCINFO_CONFIGURED] == 400) {
                if (statusCode[API_GET_ODBCINFO_DEFAULT] == 400) {
                    showMessageDialog(getCliMsg(CLIMSG_ERROR), getSvrMsg(responseData[API_GET_ODBCINFO_DEFAULT]), ACTION_ERROR, 512, 200, 'img/error_image48c.png', 0);
                }
                if (statusCode[API_GET_ODBCINFO_CONFIGURED] == 400) {
                    showMessageDialog(getCliMsg(CLIMSG_ERROR), getSvrMsg(responseData[API_GET_ODBCINFO_CONFIGURED]), ACTION_ERROR, 512, 200, 'img/error_image48c.png', 0);
                }
                return;
            } else {
                showMessageDialog(getCliMsg(CLIMSG_FAITALERROR), getCliMsg(CLIMSG_COMMUNICATIONERROR), ACTION_ERROR, 550, 280, 'img/error_image48c.png', 0);
                return;
            }
            var odbcInfos = [];
            if (responseData[API_GET_ODBCINFO_DEFAULT].Data.OdbcInfo instanceof Array) {
                odbcInfos = responseData[API_GET_ODBCINFO_DEFAULT].Data.OdbcInfo;
            } else if (responseData[API_GET_ODBCINFO_DEFAULT].Data.OdbcInfo) {
                odbcInfos.push(responseData[API_GET_ODBCINFO_DEFAULT].Data.OdbcInfo);
            }
            var odbcInfoConfigured = responseData[API_GET_ODBCINFO_CONFIGURED].Data.OdbcInfo;

            showMessageDialog(getCliMsg(CLIMSG_LABEL_ODBCCONNECTION), getCliMsg(CLIMSG_ODBCCONNSTR_GUIDE), actionType, 600, 440, 'img/config_image48c.png', 1);
            $('#adialog-content').append(getCliMsg(CLIMSG_ODBCSELECTION));
            $('#adialog-content').append('<select id="dbmsselector" style="width:250px" onchange="eventDbmsSelected()">');
            $('#adialog-content').append('</select><p>');

            if (odbcInfoConfigured.DbType === 'MariaDB') {
                $('#dbmsselector').append('<option value="MariaDB" selected>MariaDB</option>');
            } else {
                $('#dbmsselector').append('<option value="MariaDB">MariaDB</option>');
            }
            if (odbcInfoConfigured.DbType === 'PostgreSQL' || odbcInfoConfigured.DbType === 'Init') {
                $('#dbmsselector').append('<option value="PostgreSQL" selected>PostgreSQL</option>');
            } else {
                $('#dbmsselector').append('<option value="PostgreSQL">PostgreSQL</option>');
            }
            if (odbcInfoConfigured.DbType === 'MySQL') {
                $('#dbmsselector').append('<option value="MySQL" selected>MySQL</option>');
            } else {
                $('#dbmsselector').append('<option value="MySQL">MySQL</option>');
            }

            $('#adialog-content').append(getCliMsg(CLIMSG_ODBCCONNSTR_SPECIFY));
            $('#adialog-content').append('<textarea id="connstr" name="connstr" style="width:560px;height:100px" spellcheck="false"/><p>');
            if (odbcInfoConfigured.DbType === 'Init') {
                $('#connstr').append(odbcInfos[1].ConnStr);
            } else {
                $('#connstr').append(odbcInfoConfigured.ConnStr);
            }
            return;
        }
        //
        //
        if (actionType == ACTION_POSTODBCCONNSTR) {
            if (statusCode[API_POST_ODBCINFO] == 200) {
                // Nothing to do
            } else if (statusCode[API_POST_ODBCINFO] == 400) {
                showMessageDialog(getCliMsg(CLIMSG_ERROR), getSvrMsg(responseData[API_POST_ODBCINFO]), ACTION_ERROR, 512, 200, 'img/error_image48c.png', 0);
                return;
            } else {
                showMessageDialog(getCliMsg(CLIMSG_FAITALERROR), getCliMsg(CLIMSG_COMMUNICATIONERROR), ACTION_ERROR, 550, 280, 'img/error_image48c.png', 0);
                return;
            }
            if (responseData[API_POST_ODBCINFO].Data.OdbcInfo.Status === 'unconnectable') {
                showMessageDialog(getCliMsg(CLIMSG_ERROR), getCliMsg(CLIMSG_ODBCCONFAILURE), ACTION_ERROR, 512, 270, 'img/error_image48c.png', 0);
            }
            currentTablename = "";
            displaySheet();
            boxResize();
            showTableWithToolBar();

            return;
        }
        //
        //
        if (actionType == ACTION_DISPLAYDBMSTYPE) {
            if (statusCode[API_GET_ODBCINFO_CONFIGURED] == 200) {
                // Nothing to do
            } else {
                showMessageDialog(getCliMsg(CLIMSG_FAITALERROR), getCliMsg(CLIMSG_COMMUNICATIONERROR), ACTION_ERROR, 550, 280, 'img/error_image48c.png', 0);
                return;
            }
            currentDbmsname = responseData[API_GET_ODBCINFO_CONFIGURED].Data.OdbcInfo.DbType;
            if (currentDbmsname === "Init") {
                if (welcomeDlg == true) {
                    showMessageDialog(getCliMsg(CLIMSG_WELCOME), getCliMsg(CLIMSG_WELCOME) + '<br/>' + getCliMsg(CLIMSG_WELCOME_CONFIGODBC), ACTION_ERROR, 512, 220, 'img/cristal_image48c.png', 0);
                    welcomeDlg = false;
                }
                currentDbmsname = "Not configured";
            }
            $('#dbmstypeontoolbar').text(currentDbmsname);
            return;
        }
        //
        //
        if (actionType == ACTION_SHOWTABLEINFO) {
            if (currentTablename == "") {
                showMessageDialog(getCliMsg(CLIMSG_ERROR), getCliMsg(CLIMSG_TABLENOTEXIST), ACTION_ERROR, 550, 200, 'img/error_image48c.png', 0);
                return;
            }
            if (statusCode[API_GET_TABLEINFO_WITH_COL] == 200) {
                // Nothing to do
            } else if (statusCode[API_GET_TABLEINFO_WITH_COL] == 404) {
                showMessageDialog(getCliMsg(CLIMSG_ERROR), getSvrMsg(responseData[API_GET_TABLEINFO_WITH_COL]), ACTION_ERROR, 512, 200, 'img/error_image48c.png', 0);
                return;
            } else {
                showMessageDialog(getCliMsg(CLIMSG_FAITALERROR), getCliMsg(CLIMSG_COMMUNICATIONERROR), ACTION_ERROR, 550, 280, 'img/error_image48c.png', 0);
                return;
            }

            var tableInfo = responseData[API_GET_TABLEINFO_WITH_COL].Data.TableInfo;
            var columnInfos = [];
            if (tableInfo.Name === currentTablename) {
                if (tableInfo.ColumnInfo instanceof Array) {
                    columnInfos = tableInfo.ColumnInfo;
                } else if (tableInfo.ColumnInfo) {
                    columnInfos.push(tableInfo.ColumnInfo);
                }
            } else {
                showMessageDialog(getCliMsg(CLIMSG_ERROR), getCliMsg(CLIMSG_TABLENOTEXIST), ACTION_ERROR, 550, 200, 'img/error_image48c.png', 0);
                return;
            }

            showMessageDialog(getCliMsg(CLIMSG_LABEL_TABLEINFO), getCliMsg(CLIMSG_TABLEINFOSHOWN), actionType, 600, 440, 'img/table_image48c.png', 0);

            var tnReplaced = currentTablename;
            tnReplaced = tnReplaced.replace(/&/g, "&amp;");
            tnReplaced = tnReplaced.replace(/</g, "&lt;");
            tnReplaced = tnReplaced.replace(/>/g, "&gt;");
            tnReplaced = tnReplaced.replace(/\"/g, "&quot;");
            $('#adialog-content').append(getCliMsg(CLIMSG_LABEL_TARGETTABLE) + tnReplaced + '<br>');
            $('#adialog-content').append('<table class="tblstyle">');
            $('.tblstyle').append('<tr><th>Column name</th><th>Column type</th><th>Is nullable</th></tr>');
            for (var ColLoop = 0; ColLoop < columnInfos.length; ColLoop++) {
                var cnReplaced = columnInfos[ColLoop].title;
                cnReplaced = cnReplaced.replace(/&/g, "&amp;");
                cnReplaced = cnReplaced.replace(/</g, "&lt;");
                cnReplaced = cnReplaced.replace(/>/g, "&gt;");
                cnReplaced = cnReplaced.replace(/\"/g, "&quot;");
                $('.tblstyle').append('<tr><td>' + cnReplaced + '</td><td>' + columnInfos[ColLoop].coltype + '</td><td>' + columnInfos[ColLoop].isnull + '</td></tr>');
            }
            $('#adialog-content').append('</table>');
            return;
        }
        //
        //
        if (actionType == ACTION_GETFILTERINFO) {
            if (currentTablename == "") {
                showMessageDialog(getCliMsg(CLIMSG_ERROR), getCliMsg(CLIMSG_FILTERING_NO_TABLE), ACTION_ERROR, 550, 200, 'img/error_image48c.png', 0);
                return;
            }
            if (statusCode[API_GET_FILTERINFO] == 200 && statusCode[API_GET_TABLEINFO_WITH_COL] == 200) {
                // Nothing to do
            } else if (statusCode[API_GET_TABLEINFO_WITH_COL] == 404) {
                showMessageDialog(getCliMsg(CLIMSG_ERROR), getSvrMsg(responseData[API_GET_TABLEINFO_WITH_COL]), ACTION_ERROR, 512, 200, 'img/error_image48c.png', 0);
                return;
            } else {
                showMessageDialog(getCliMsg(CLIMSG_FAITALERROR), getCliMsg(CLIMSG_COMMUNICATIONERROR), ACTION_ERROR, 550, 280, 'img/error_image48c.png', 0);
                return;
            }
            showMessageDialog(getCliMsg(CLIMSG_LABEL_FILTERING), getCliMsg(CLIMSG_FILTERING_DESC), actionType, 600, 440, 'img/filter_image48c.png', 1);
            for (var Loop = 1; Loop <= 5; Loop++) {
                $('#adialog-content').append('' + Loop + ': ');
                var paramCol = document.createElement('select');
                paramCol.id = 'paramCol' + Loop;
                paramCol.style.width = '130px';
                paramCol.align = 'middle';
                paramCol.onchange = function() {;
                    eventParamColChanged(this);
                }
                $('#adialog-content').append(paramCol);
                $('#adialog-content').append(' ');
                var paramOpe = document.createElement('select');
                paramOpe.id = 'paramOpe' + Loop;
                paramOpe.style.width = '140px';
                paramOpe.align = 'middle';
                paramOpe.onchange = function() {;
                    eventParamOpeChanged(this);
                }
                $('#adialog-content').append(paramOpe);
                $('#adialog-content').append(' ');
                var paramVal = document.createElement('input');
                paramVal.id = 'paramVal' + Loop;
                paramVal.type = 'text';
                paramVal.size = '30';
                paramVal.align = 'middle';
                $('#adialog-content').append(paramVal);
                $('#adialog-content').append('<p>');
            }

            var columnInfos = [];
            if (responseData[API_GET_TABLEINFO_WITH_COL].Data.TableInfo.ColumnInfo instanceof Array) {
                columnInfos = responseData[API_GET_TABLEINFO_WITH_COL].Data.TableInfo.ColumnInfo;
            } else if (responseData[API_GET_TABLEINFO_WITH_COL].Data.TableInfo.ColumnInfo) {
                columnInfos.push(responseData[API_GET_TABLEINFO_WITH_COL].Data.TableInfo.ColumnInfo);
            }

            var filterInfo = responseData[API_GET_FILTERINFO].Data.FilterInfo.Criteria;

            for (var LoopCol = 1; LoopCol <= 5; LoopCol++) {
                $('#paramOpe' + LoopCol).attr('disabled', 'disabled');
                $('#paramVal' + LoopCol).attr('disabled', 'disabled');
                $('#paramCol' + LoopCol).append('<option value="*">' + getCliMsg(CLIMSG_FILTERING_UNSPECIFY) + '</option>');
                var filFndFlag = false;
                for (var Loop in columnInfos) {
                    var seld = '';
                    if (columnInfos[Loop].title == filterInfo[LoopCol - 1].columnname) {
                        seld = 'selected';
                        filFndFlag = true;
                    }
                    var cnReplaced = columnInfos[Loop].title;
                    cnReplaced = cnReplaced.replace(/&/g, "&amp;");
                    cnReplaced = cnReplaced.replace(/</g, "&lt;");
                    cnReplaced = cnReplaced.replace(/>/g, "&gt;");
                    cnReplaced = cnReplaced.replace(/\"/g, "&quot;");
                    $('#paramCol' + LoopCol).append('<option value="' + cnReplaced + '" ' + seld + '>' + cnReplaced + '</option>');
                }
                if (filFndFlag == false && filterInfo[LoopCol - 1].columnname != '*') {
                    $('#adialog-content').empty();
                    $('#adialog-content').append('<br>' + getCliMsg(CLIMSG_FILTERING_INVALID) + '<br>');
                    return;
                }
                eventParamColChanged($('#paramCol' + LoopCol).get(0));
                switch (filterInfo[LoopCol - 1].opetype) {
                    case 1  : $('#paramOpe' + LoopCol).val('equals'); break;
                    case 2  : $('#paramOpe' + LoopCol).val('notequal'); break;
                    case 3  : $('#paramOpe' + LoopCol).val('equalslesserthan'); break;
                    case 4  : $('#paramOpe' + LoopCol).val('lesserthan'); break;
                    case 5  : $('#paramOpe' + LoopCol).val('equalsgreaterthan'); break;
                    case 6  : $('#paramOpe' + LoopCol).val('greaterthan'); break;
                    case 10 : $('#paramOpe' + LoopCol).val('contains'); break;
                    case 11 : $('#paramOpe' + LoopCol).val('notcontain'); break;
                    case 20 : $('#paramOpe' + LoopCol).val('null'); $('#paramVal' + LoopCol).attr('disabled', 'disabled'); break;
                    case 21 : $('#paramOpe' + LoopCol).val('notnull'); $('#paramVal' + LoopCol).attr('disabled', 'disabled'); break;
                }
                $('#paramVal' + LoopCol).val(filterInfo[LoopCol - 1].value);
            }
            return;
        }
        //
        //
        if (actionType == ACTION_POSTFILTERINFO) {
            showTable();
            $('#adialog').dialog('close');
            return;
        }
        //
        //
        if (actionType == ACTION_GETFILTERSW) {
            var switchflag = '';
            if (responseData[API_GET_FILTERINFO].Data.FilterInfo.Function === 'enable') {
                $('#filteringonoff').prop("checked", true);
            }
            if (responseData[API_GET_FILTERINFO].Data.FilterInfo.Function === 'disable') {
                $('#filteringonoff').prop("checked", false);
            }
            return;
        }
        if (actionType == ACTION_TURNFILTERSWON || actionType == ACTION_TURNFILTERSWOFF) {
            showTable();
            return;
        }
        //
        //
        if (actionType == ACTION_SHOWTABLE) {
            if (statusCode[API_GET_TABLEINFO_WITH_COL] == 200 && statusCode[API_GET_RECORDS] == 200) {
                // Nothing to do
            } else if (statusCode[API_GET_RECORDS] == 400) {
                showMessageDialog(getCliMsg(CLIMSG_ERROR), getSvrMsg(responseData[API_GET_RECORDS]), ACTION_ERROR, 512, 200, 'img/error_image48c.png', 0);
                return;
            } else if (statusCode[API_GET_RECORDS] == 404) {
                showMessageDialog(getCliMsg(CLIMSG_ERROR), getSvrMsg(responseData[API_GET_RECORDS]), ACTION_ERROR, 512, 200, 'img/error_image48c.png', 0);
                return;
            } else {
                showMessageDialog(getCliMsg(CLIMSG_FAITALERROR), getCliMsg(CLIMSG_COMMUNICATIONERROR), ACTION_ERROR, 550, 280, 'img/error_image48c.png', 0);
                return;
            }

            var columnInfo = [];
            if (responseData[API_GET_TABLEINFO_WITH_COL].Data.TableInfo.ColumnInfo instanceof Array) {
                columnInfo = JSON.parse(JSON.stringify(responseData[API_GET_TABLEINFO_WITH_COL].Data.TableInfo.ColumnInfo));
            } else if (responseData[API_GET_TABLEINFO_WITH_COL].Data.TableInfo.ColumnInfo) {
                columnInfo.push(JSON.parse(JSON.stringify(responseData[API_GET_TABLEINFO_WITH_COL].Data.TableInfo.ColumnInfo)));
            }
            for (var Loop in columnInfo) {
                columnInfo[Loop].title = columnInfo[Loop].title.replace(/&/g, "&amp;");
                columnInfo[Loop].title = columnInfo[Loop].title.replace(/</g, "&lt;");
                columnInfo[Loop].title = columnInfo[Loop].title.replace(/>/g, "&gt;");
                columnInfo[Loop].title = columnInfo[Loop].title.replace(/\"/g, "&quot;");
            }

            var records = [];
            if (responseData[API_GET_RECORDS].Data.Record instanceof Array) {
                records = JSON.parse(JSON.stringify(responseData[API_GET_RECORDS].Data.Record));
            } else if (responseData[API_GET_RECORDS].Data.Record) {
                records.push(JSON.parse(JSON.stringify(responseData[API_GET_RECORDS].Data.Record)));
            }
            for (var Loop in records) {
                var record = records[Loop];
                for (var colLoop = 0; colLoop < Object.keys(records[Loop]).length; colLoop++) {
                    records[Loop][colLoop] = records[Loop][colLoop].replace(/&/g, "&amp;");
                    records[Loop][colLoop] = records[Loop][colLoop].replace(/</g, "&lt;");
                    records[Loop][colLoop] = records[Loop][colLoop].replace(/>/g, "&gt;");
                    records[Loop][colLoop] = records[Loop][colLoop].replace(/\"/g, "&quot;");
                }
            }

            var tnReplaced = currentTablename;
            tnReplaced = tnReplaced.replace(/&/g, "&amp;");
            tnReplaced = tnReplaced.replace(/</g, "&lt;");
            tnReplaced = tnReplaced.replace(/>/g, "&gt;");
            tnReplaced = tnReplaced.replace(/\"/g, "&quot;");
            var obj = { title: tnReplaced, editable: false };
            $('#grid_array').pqGrid({colModel: columnInfo});
            obj.dataModel = { data: records, dataType: 'JSON', paging: 'local', rPPOptions:[100, 200, 400], rPP:100, curPage:1 };
            $('#grid_array').pqGrid(obj);
            return;
        }
        //
        //
        if (actionType == ACTION_INFO) {
            var buildTime = "";
            var startTime = "";
            var productName = "";
            var version = "";
            if (statusCode[API_GET_SYSTEM] == 200) {
                buildTime = responseData[API_GET_SYSTEM].Data.BuildTime;
                startTime = responseData[API_GET_SYSTEM].Data.StartTime;
                productName = responseData[API_GET_SYSTEM].Data.ProductName;
                version = responseData[API_GET_SYSTEM].Data.Version;
            } else {
                showMessageDialog(getCliMsg(CLIMSG_FAITALERROR), getCliMsg(CLIMSG_COMMUNICATIONERROR), ACTION_ERROR, 550, 280, 'img/error_image48c.png', 0);
                return;
            }

            var Logs = [];
            if (statusCode[API_GET_LOGS] == 200) {
                if (responseData[API_GET_LOGS].Data.Log instanceof Array) {
                    Logs = responseData[API_GET_LOGS].Data.Log;
                } else if (responseData[API_GET_LOGS].Data.Log) {
                    Logs.push(responseData[API_GET_LOGS].Data.Log);
                }
            } else {
                showMessageDialog(getCliMsg(CLIMSG_FAITALERROR), getCliMsg(CLIMSG_COMMUNICATIONERROR), ACTION_ERROR, 550, 280, 'img/error_image48c.png', 0);
                return;
            }

            showMessageDialog(getCliMsg(CLIMSG_LABEL_INFORMATION), '' + productName + ' ' + version + '<br/>Copyright (C) 2018 Shinya Takeuchi<br/>All Rights Reserved.', actionType, 600, 440, 'img/info_image48c.png', 0);
            $('#adialog-content').append('' + getCliMsg(CLIMSG_TECH_EMBEDDED) + '<br/>- Mongoose 3.7 (Released as MIT License)<br/>- JQuery 1.9.1 (Released as MIT License)<br/>- JQuery UI 1.10.3 (Released as MIT License)<br/>- ParamQuery Grid 1.1.2 (Released as MIT License)<br/>');
            $('#adialog-content').append('<p>');
            $('#adialog-content').append('<a href="' + getCliMsg(CLIMSG_OPEN_MANUAL_URL) + '" target="manual">' + getCliMsg(CLIMSG_OPEN_MANUAL) + '</a><p>');
            $('#adialog-content').append('Build Time = ' + buildTime + '<br/>');
            $('#adialog-content').append('Service Start Time = ' + startTime + '<br/>');
            $('#adialog-content').append('<br/>');
            $('#adialog-content').append('' + getCliMsg(CLIMSG_TRACELOG));
            var tmpTbl = $('<table class="tblstyle"><tr><th>' + getCliMsg(CLIMSG_LABEL_LOGTIME) + '</th><th>' + getCliMsg(CLIMSG_LABEL_LOGMSG) + '</th></tr></table>');
            $('#adialog-content').append(tmpTbl);
            for (var loop = 0; loop < Logs.length; loop++) {
                if (myLanguage == 1) {
                    tmpTbl.append($('<tr></tr>')
                        .append($('<td></td>').text(Logs[loop].Time))
                        .append($('<td></td>').text(Logs[loop].MsgJa))
                    );
                } else {
                    tmpTbl.append($('<tr></tr>')
                        .append($('<td></td>').text(Logs[loop].Time))
                        .append($('<td></td>').text(Logs[loop].MsgEn))
                    );
                }
            }
            $('#adialog-content').append('</table><br/>');
            return;
        }
        //
        //
    }
    setTimeout(function() {closeWaitingDialogAndExecuteNextAction(actionType);}, 500);
}

function showWaitingDialog(actionType, count) {
    if (count < 10) {
        if (underComm == 0) {
            closeWaitingDialogAndExecuteNextAction(actionType);
        } else {
            setTimeout(function() {showWaitingDialog(actionType, count + 1);}, 50);
        }
        return;
    }
    $('#wdialog').dialog({
        autoOpen:true,
        modal:true,
        position:'center',
        draggable:false,
        resizable: false,
        height:85,
        width:400,
        open : function(event, ui) {
            $('.ui-dialog-titlebar').hide();
            $(".ui-dialog-titlebar-close").hide();
        },
        close : function(event, ui) {
            $('.ui-dialog-titlebar').show();
            $(".ui-dialog-titlebar-close").show();
        }
    });
    $('#wdialog-content').empty();
    $('#wdialog-content').append(getCliMsg(CLIMSG_WAITFORAWHILE));
    setTimeout(function() {closeWaitingDialogAndExecuteNextAction(actionType);}, 500);
}

function showMessageDialog(title, message, actionType, width, height, icon, buttonType) {
    $('#adialog').dialog({ autoOpen:true, title:title, modal:true, position:'center', draggable:true, resizable: false, height:height, width:width });
    $('#adialog-icon').empty();
    $('#adialog-msg').empty();
    $('#adialog-content').empty();
    $('#adialog-button').empty();
    $('#adialog-icon').append('<img src="' + icon + '"/>');
    $('#adialog-msg').append(message);
    displayButton('adialog-button', 'img/ok_image32s.png', 'img/ok_image32c.png', 'OK', actionType + 1);
    if (buttonType == 1) {
        displayButton('adialog-button', 'img/ng_image32s.png', 'img/ng_image32c.png', 'ｷｬﾝｾﾙ', actionType + 2);
    }
}

function sendRequestRecvResponse(method, url, request, index) {
    underComm++;
    if (method === 'GET') {
        $.ajax({
            type: method,
            dataType: 'json',
            url: url,
            data: request,
            async: true,
            timeout: 7000,
            success: function(msg, textStatus, xhr) {
                statusCode[index] = xhr.status;
                $.extend(responseData[index], msg);
                underComm--;
            },
            error: function(xhr, textStatus, errorThrown) {
                if (textStatus === 'timeout') {
                    statusCode[index] = -1;
                } else {
                    statusCode[index] = xhr.status;
                    $.extend(responseData[index], JSON.parse(xhr.responseText));
                }
                underComm--;
            }
        });
    } else {
        $.ajax({
            type: method,
            dataType: 'json',
            url: url,
            data: JSON.stringify(request),
            contentType: 'application/json',
            async: true,
            timeout: 7000,
            success: function(msg, textStatus, xhr) {
                statusCode[index] = xhr.status;
                $.extend(responseData[index], msg);
                underComm--;
            },
            error: function(xhr, textStatus, errorThrown) {
                if (textStatus === 'timeout') {
                    statusCode[index] = -1;
                } else {
                    statusCode[index] = xhr.status;
                    $.extend(responseData[index], JSON.parse(xhr.responseText));
                }
                underComm--;
            }
        });
    }
    return;
}

function refreshTableNameList() {
    onXxxAction(ACTION_GETTABLEINFO);
}

function eventTableSelected() {
    var selectedTableName = $('#tableselector').val();
    var tnReplaced = selectedTableName;
    tnReplaced = tnReplaced.replace(/&lt;/g, "<");
    tnReplaced = tnReplaced.replace(/&gt;/g, ">");
    tnReplaced = tnReplaced.replace(/&quot;/g, "\"");
    tnReplaced = tnReplaced.replace(/&amp;/g, "&");

    currentTablename = tnReplaced;
    showTable();
}

function eventFilterOn(checkboxObj) {
    if (checkboxObj.checked == true) {
        onXxxAction(ACTION_TURNFILTERSWON);
    } else {
        onXxxAction(ACTION_TURNFILTERSWOFF);
    }
}

function eventDbmsSelected() {
    var selectedDbmsName = $('#dbmsselector').val();

    var odbcInfos = [];
    if (responseData[API_GET_ODBCINFO_DEFAULT].Data.OdbcInfo instanceof Array) {
        odbcInfos = responseData[API_GET_ODBCINFO_DEFAULT].Data.OdbcInfo;
    } else if (responseData[API_GET_ODBCINFO_DEFAULT].Data.OdbcInfo) {
        odbcInfos.push(responseData[API_GET_ODBCINFO_DEFAULT].Data.OdbcInfo);
    }

    $('#connstr').empty();
    for (var loop = 0; loop < odbcInfos.length; loop++) {
        if (selectedDbmsName === odbcInfos[loop].DbType) {
            $('#connstr').append(odbcInfos[loop].ConnStr);
        }
    }
}

function eventParamColChanged(selectObj) {
    var columnInfos = [];
    if (responseData[API_GET_TABLEINFO_WITH_COL].Data.TableInfo.ColumnInfo instanceof Array) {
        columnInfos = responseData[API_GET_TABLEINFO_WITH_COL].Data.TableInfo.ColumnInfo;
    } else if (responseData[API_GET_TABLEINFO_WITH_COL].Data.TableInfo.ColumnInfo) {
        columnInfos.push(responseData[API_GET_TABLEINFO_WITH_COL].Data.TableInfo.ColumnInfo);
    }

    var valstr = selectObj.options[selectObj.selectedIndex].value;
    var fetchedId = selectObj.id.substring(8, 9);
    if (selectObj.selectedIndex == 0) {
        $('#paramOpe' + fetchedId).attr('disabled', 'disabled');
        $('#paramVal' + fetchedId).attr('disabled', 'disabled');
        return;
    }
    $('#paramOpe' + fetchedId).removeAttr('disabled');
    $('#paramVal' + fetchedId).removeAttr('disabled');
    var paramOpe = '#paramOpe' + fetchedId;
    $(paramOpe).empty();
    $(paramOpe).append('<option value="equals">=</option>');
    $(paramOpe).append('<option value="notequal">!=</option>');
    if (columnInfos[selectObj.selectedIndex - 1].dataType === 'integer' ||
        columnInfos[selectObj.selectedIndex - 1].dataType === 'float') {
        $(paramOpe).append('<option value="equalslesserthan">&lt;=</option>');
        $(paramOpe).append('<option value="lesserthan">&lt;</option>');
        $(paramOpe).append('<option value="equalsgreaterthan">&gt;=</option>');
        $(paramOpe).append('<option value="greaterthan">&gt;</option>');
    }
    if (columnInfos[selectObj.selectedIndex - 1].dataType === 'string') {
        $(paramOpe).append('<option value="contains">contains</option>');
        $(paramOpe).append('<option value="notcontain">does not contain</option>');
    }
    $(paramOpe).append('<option value="null">is NULL</option>');
    $(paramOpe).append('<option value="notnull">is not NULL</option>');
}

function eventParamOpeChanged(selectObj) {
    var fetchedId = selectObj.id.substring(8, 9);
    if (selectObj.options[selectObj.selectedIndex].value == "notnull" ||
        selectObj.options[selectObj.selectedIndex].value == "null") {
        $('#paramVal' + fetchedId).attr('disabled', 'disabled');
    } else {
        $('#paramVal' + fetchedId).removeAttr('disabled');
    }
}

function showTable() {
    onXxxAction(ACTION_SHOWTABLE);
}

function initializeCurrentTablename() {
    var selectedTableName = $('#tableselector').val();
    if (selectedTableName == null) {
        currentTablename = "";
    } else {
        var tnReplaced = selectedTableName;
        tnReplaced = tnReplaced.replace(/&lt;/g, "<");
        tnReplaced = tnReplaced.replace(/&gt;/g, ">");
        tnReplaced = tnReplaced.replace(/&quot;/g, "\"");
        tnReplaced = tnReplaced.replace(/&amp;/g, "&");

        currentTablename = tnReplaced;
    }
}

function onXxxAction(actionType) {
    // If this method is called by an operation on adialog, close the dialog firstly.
    if (actionType % 10 == 1 || actionType % 10 == 2) {
        $('#adialog').dialog('close');
    }

    if (actionType == ACTION_LAUNCH) {
        sendRequestRecvResponse('GET', './api/language/', null, API_GET_LANGUAGE);
        showWaitingDialog(ACTION_LAUNCH, 0);
        return;
    }
    if (actionType == ACTION_GETTABLEINFO) {
        sendRequestRecvResponse('GET', './api/tableinfo/', null, API_GET_TABLEINFO);
        showWaitingDialog(ACTION_GETTABLEINFO, 0);
        return;
    }
    if (actionType == ACTION_GETODBCCONNSTR) {
        var reqDatDf = {'query' : 'default' };
        sendRequestRecvResponse('GET', './api/odbcinfo/', reqDatDf, API_GET_ODBCINFO_DEFAULT);
        var reqDatCf = {'query' : 'configured' };
        sendRequestRecvResponse('GET', './api/odbcinfo/', reqDatCf, API_GET_ODBCINFO_CONFIGURED);
        showWaitingDialog(ACTION_GETODBCCONNSTR, 0);
        return;
    }
    if (actionType == ACTION_POSTODBCCONNSTR) {
        var selectedDbmsName = $('#dbmsselector').val();
        var tmpstr = $('#connstr').val().replace(/[\n\r]/g, '');
        var reqDatDf = {'DbType' : selectedDbmsName, 'ConnStr' : tmpstr};
        sendRequestRecvResponse('POST', './api/odbcinfo/', reqDatDf, API_POST_ODBCINFO);
        showWaitingDialog(ACTION_POSTODBCCONNSTR, 0);
        return;
    }
    if (actionType == ACTION_DISPLAYDBMSTYPE) {
        var reqDatCf = {'query' : 'configured' };
        sendRequestRecvResponse('GET', './api/odbcinfo/', reqDatCf, API_GET_ODBCINFO_CONFIGURED);
        showWaitingDialog(ACTION_DISPLAYDBMSTYPE, 0);
        return;
    }
    if (actionType == ACTION_SHOWTABLEINFO) {
        var reqDatDf = {'query' : currentTablename};
        sendRequestRecvResponse('GET', './api/tableinfo/', reqDatDf, API_GET_TABLEINFO_WITH_COL);
        showWaitingDialog(ACTION_SHOWTABLEINFO, 0);
        return;
    }
    if (actionType == ACTION_GETFILTERINFO) {
        var reqDatDf = {'query' : currentTablename};
        sendRequestRecvResponse('GET', './api/tableinfo/', reqDatDf, API_GET_TABLEINFO_WITH_COL);
        sendRequestRecvResponse('GET', './api/filterinfo/', null, API_GET_FILTERINFO);
        showWaitingDialog(ACTION_GETFILTERINFO, 0);
        return;
    }
    if (actionType == ACTION_POSTFILTERINFO) {
        if (currentTablename == "") {
            return;
        }
        var Criteria = [{index : 0, columnname : "", opetype : 0, value : ""},
                        {index : 0, columnname : "", opetype : 0, value : ""},
                        {index : 0, columnname : "", opetype : 0, value : ""},
                        {index : 0, columnname : "", opetype : 0, value : ""},
                        {index : 0, columnname : "", opetype : 0, value : ""}
        ];

        for (var Loop = 1; Loop <= 5; Loop++) {
            var paramCol = $('#paramCol' + Loop + ' option:selected').val();
            var paramOpe = $('#paramOpe' + Loop + ' option:selected').val();
            var paramVal = $('#paramVal' + Loop).val();
            var paramOpeInt = 0;

            if (typeof paramCol === 'undefined' || typeof paramOpe === 'undefined' || typeof paramVal === 'undefined') {
                paramCol = '*';
                paramVal = '';
            } else {;
                switch (paramOpe) {
                    case 'equals'            : paramOpeInt = 1; break;
                    case 'notequal'          : paramOpeInt = 2; break;
                    case 'equalslesserthan'  : paramOpeInt = 3; break;
                    case 'lesserthan'        : paramOpeInt = 4; break;
                    case 'equalsgreaterthan' : paramOpeInt = 5; break;
                    case 'greaterthan'       : paramOpeInt = 6; break;
                    case 'contains'          : paramOpeInt = 10; break;
                    case 'notcontain'        : paramOpeInt = 11; break;
                    case 'null'              : paramOpeInt = 20; break;
                    case 'notnull'           : paramOpeInt = 21; break;
                }
            }

            paramCol = paramCol.replace(/&lt;/g, "<");
            paramCol = paramCol.replace(/&gt;/g, ">");
            paramCol = paramCol.replace(/&quot;/g, "\"");
            paramCol = paramCol.replace(/&amp;/g, "&");

            Criteria[Loop - 1].index = Loop;
            Criteria[Loop - 1].columnname = JSON.parse(JSON.stringify(paramCol));
            Criteria[Loop - 1].opetype = paramOpeInt;
            Criteria[Loop - 1].value = JSON.parse(JSON.stringify(paramVal));
        }
        var reqDatDf = {"Criteria":Criteria};
        sendRequestRecvResponse('POST', './api/filterinfo/', reqDatDf, API_POST_FILTERINFO);
        showWaitingDialog(ACTION_POSTFILTERINFO, 0);
        return;
    }
    if (actionType == ACTION_GETFILTERSW) {
        sendRequestRecvResponse('GET', './api/filterinfo/', null, API_GET_FILTERINFO);
        showWaitingDialog(ACTION_GETFILTERSW, 0);
        return;   
    }
    if (actionType == ACTION_TURNFILTERSWON) {
        var reqDatDf = {"Function":"enable"};
        sendRequestRecvResponse('POST', './api/filterinfo/', reqDatDf, API_POST_FILTERINFO);
        showWaitingDialog(ACTION_TURNFILTERSWON, 0);
        return;   
    }
    if (actionType == ACTION_TURNFILTERSWOFF) {
        var reqDatDf = {"Function":"disable"};
        sendRequestRecvResponse('POST', './api/filterinfo/', reqDatDf, API_POST_FILTERINFO);
        showWaitingDialog(ACTION_TURNFILTERSWOFF, 0);
        return;   
    }
    if (actionType == ACTION_REFRESH) {
        showTableWithToolBar();
        return;
    }
    if (actionType == ACTION_SHOWTABLE) {
        var reqDatDf = {'query' : currentTablename};
        sendRequestRecvResponse('GET', './api/tableinfo/', reqDatDf, API_GET_TABLEINFO_WITH_COL);
        sendRequestRecvResponse('GET', './api/records/', reqDatDf, API_GET_RECORDS);
        showWaitingDialog(ACTION_SHOWTABLE, 0);
        return;
    }
    if (actionType == ACTION_INFO) {
        sendRequestRecvResponse('GET', './api/system/', null, API_GET_SYSTEM);
        sendRequestRecvResponse('GET', './api/logs/', null, API_GET_LOGS);
        showWaitingDialog(ACTION_INFO, 0);
        return;
    }
}

</script>
</head>


<body style="overflow: hidden;" onresize="boxResize()">
<div id="container"><div class="spc">
<div class="headtailbar">
    <table class="ttblstyle" width="100%"><tr>
        <td align="left"><b>CmdFreak</b></td>
        <td align="right">1.1.0</td>
    </tr></table>
</div>

<div id="box_info">
    <noscript>
        JavaScript is disabled in your browser.<br>Change the browser setting to enable it and refresh the page.<br>
    </noscript>

    <div id="mainarea" style="display:none">
        <div id="adialog">
            <table class="ttblstyle" width="100%"><tr>
            <td id="adialog-icon" width="60px"></td><td id="adialog-msg"></td>
            </tr></table><p>
            <div id="adialog-content" align="left"></div>
            <hr/>
            <div id="adialog-button" align="right"></div>
        </div>
        <div id="wdialog">
            <div id="wdialog-content" align="center"></div>
        </div>
    </div>
    <div id="grid_array">
    </div>
</div>

</div></div>
</body>

</html>
