<!DOCTYPE html>

<html lang="ja">

<HEAD>
<title>CmdFreak</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" href="./style.css" type="text/css">
</HEAD>

<BODY>
<div id="container">
<H1>2. 内部処理</H1>

<H2 ID="2.1">2.1 REST API仕様</H2>
<div class="topic">
CmdFreakのREST APIは，以下の一覧に示すAPIをクライアント提供します。
<table class="tblstyle">
<tr><td>GET /api/system/</td><td>CmdFreakのサーバ情報(Build Time, Server Start Time, Number of Worker Thread)を取得する。</td></tr>
<tr><td>GET /api/language/</td><td>クライアント（ブラウザ）の最優先の言語を取得する。</td></tr>
<tr><td>GET /api/logs/</td><td>イベントログを取得する。</td></tr>
<tr><td>GET /api/odbcinfos/</td><td>ODBCの情報を取得する。</td></tr>
<tr><td>POST /api/odbcinfos/</td><td>ODBCの情報を設定する。</td></tr>
</table>
</div><p>



<H2 ID="2.2">2.2 Get /api/system/</H2>
<div class="topic">
CmdFreakのサーバ情報(プログラム名称, バージョン, ビルド時刻, 起動時刻, 動作スレッド数)を取得します。
<ul>
<li>リクエスト
<p>なし</p>
</li>
<li>レスポンス
<pre>
{
  "Code" : 1234,
  "MsgEng" : "abc",
  "MsgJpn" : "あいう",
  "Data" : {
    "ProductName" : "CmdFreak",
    "Version" : "1.1.0",
    "BuildTime" : "May 21 2017 19:30:02",
    "StartTime" : "May 21 2017 19:30:02",
    "NumOfThreads" : 4
  }
}
</pre>
<table class="tblstyle">
<tr><td>Code</td><td>Integer</td><td>結果コード。0:成功(HTTPステータスコード=200)。</td></tr>
<tr><td>MsgEng</td><td>String</td><td>英文メッセージ。結果コードが0のときは空文字が返る。</td></tr>
<tr><td>MsgJpn</td><td>String</td><td>和文メッセージ。結果コードが0のときは空文字が返る。</td></tr>
<tr><td>Data</td><td>Element</td><td>結果コードが0でないとき，この要素は返却されない。</td></tr>
<tr><td>ProductName</td><td>String</td><td>プログラム名称。"CmdFreak"</td></tr>
<tr><td>Version</td><td>String</td><td>バージョン番号。</td></tr>
<tr><td>BuildTime</td><td>String</td><td>プログラムをビルドした時間。</td></tr>
<tr><td>StartTime</td><td>String</td><td>サービスを起動した時間。</td></tr>
<tr><td>NumOfThreads</td><td>Integer</td><td>動作しているワーカースレッドの数。</td></tr>
</table><br/>
</li>
</ul>
</div><p>


<H2 ID="2.3">2.3 Get /api/language/</H2>
<div class="topic">
クライアント（ブラウザ）の最優先の言語を取得します。<br/>
具体的には，クライアント・リクエストのHTTPヘッダのAccept-Languageに指定した言語のうち，先頭に指定した言語（2文字）を取得します。<br/>
Code要素が0ではないとき，Data要素は返されません。
<ul>
<li>リクエスト
<p>なし</p>
</li>
<li>レスポンス
<pre>
{
  "Code" : 1234,
  "MsgEng" : "abc",
  "MsgJpn" : "あいう",
  "Data" : {
    "ClientLanguage" : "ja",
  }
}
</pre>
<table class="tblstyle">
<tr><td>Code</td><td>Integer</td><td>結果コード。0:成功(HTTPステータスコード=200), 3120:クライアントのロケールを検知できなかった(HTTPステータスコード=406)。</td></tr>
<tr><td>MsgEng</td><td>String</td><td>英文メッセージ。結果コードが0のときは空文字が返る。</td></tr>
<tr><td>MsgJpn</td><td>String</td><td>和文メッセージ。結果コードが0のときは空文字が返る。</td></tr>
<tr><td>Data</td><td>Element</td><td>結果コードが0でないとき，この要素は返却されない。</td></tr>
<tr><td>ClientLanguage</td><td>String</td><td>クライアント（ブラウザ）の最優先の言語(2文字; 日本語="ja"，英語="en")。結果コードが0でないとき，この要素は返却されない。</td></tr>
</table><br/>
</li>
</ul>
</div><p>


<H2 ID="2.4">2.4 Get /api/logs/</H2>
<div class="topic">
イベントログを取得します。<br/>
イベントログが複数あるときは配列形式のデータが返却されます。イベントログがひとつしかないときはオブジェクトが返却されます。
<ul>
<li>リクエスト
<p>なし</p>
</li>
<li>レスポンス
<pre>
{
  "Code" : 1234,
  "MsgEng" : "abc",
  "MsgJpn" : "あいう",
  "Data" : {
    "Log" : [
      {
        "Time" : "Jun 21 2017 23:20:54",
        "MsgEn" : "CmdFreak service has stopped.",
        "MsgJa" : "CmdFreakサービスを停止しました。"
      },
      {
        "Time" : "Jul 8 2017 12:03:04",
        "MsgEn" : "CmdFreak service has started.",
        "MsgJa" : "CmdFreakサービスを開始しました。"
      }
    ]
  }
}
</pre>
<table class="tblstyle">
<tr><td>Code</td><td>Integer</td><td>結果コード。0:成功(HTTPステータスコード=200)。</td></tr>
<tr><td>MsgEng</td><td>String</td><td>英文メッセージ。結果コードが0のときは空文字が返る。</td></tr>
<tr><td>MsgJpn</td><td>String</td><td>和文メッセージ。結果コードが0のときは空文字が返る。</td></tr>
<tr><td>Data</td><td>Element</td><td>結果コードが0でないとき，この要素は返却されない。</td></tr>
<tr><td>Log</td><td>Element</td><td>結果コードが0でないとき，この要素は返却されない。</td></tr>
<tr><td>Time</td><td>String</td><td>イベントログが登録された時刻。"Month Day Year HH:MM:SS" 形式で返却される。</td></tr>
<tr><td>MsgEn</td><td>String</td><td>イベントログの英語メッセージ。</td></tr>
<tr><td>MsgJa</td><td>String</td><td>イベントログの日本語メッセージ。</td></tr>
</table><br/>
</li>
</ul>
</div><p>


<H2 ID="2.5">2.5 Get /api/odbcinfos/</H2>
<div class="topic">
ODBCの情報を取得します。<br/>
<ul>
<li>リクエスト
<pre>
?query=default
</pre>
<table class="tblstyle">
<tr><td>query</td><td>String</td><td>default:デフォルト接続文字列を取得したい場合。configured:設定済の接続文字列を取得したい場合。</td></tr>
</table><br/>
</li>
<li>レスポンス
<pre>
&lt;query=default&gt;
{
  "Code" : 1234,
  "MsgEng" : "abc",
  "MsgJpn" : "あいう",
  "Data" : {
    "OdbcInfo" : [
      {
        "DbType" : "PostgreSQL",
        "ConnStr" : "xxx",
      },
      {
        "DbType" : "MySQL",
        "ConnStr" : "xxx",
      }
    ]
  }
}
</pre>
<pre>
&lt;query=configured&gt;
{
  "Code" : 1234,
  "MsgEng" : "abc",
  "MsgJpn" : "あいう",
  "Data" : {
    "OdbcInfo" : {
      {
        "DbType" : "PostgreSQL",
        "ConnStr" : "xxx",
        "Status" : "connectable"
      }
    }
  }
}
</pre>
<table class="tblstyle">
<tr><td>Code</td><td>Integer</td><td>結果コード。0:成功(HTTPステータスコード=200)，3121:リクエストがquery=default, query=configuredの何れでもない(HTTPステータスコード=400)。</td></tr>
<tr><td>MsgEng</td><td>String</td><td>英文メッセージ。結果コードが0のときは空文字が返る。</td></tr>
<tr><td>MsgJpn</td><td>String</td><td>和文メッセージ。結果コードが0のときは空文字が返る。</td></tr>
<tr><td>Data</td><td>Element</td><td>結果コードが0でないとき，この要素は返却されない。</td></tr>
<tr><td>OdbcInfo</td><td>Element</td><td>結果コードが0でないとき，この要素は返却されない。</td></tr>
<tr><td>DbType</td><td>String</td><td>DBMSの種別。"PostgreSQL", "MySQL", "MariaDB"の何れか。結果コードが0でないとき，この要素は返却されない。</td></tr>
<tr><td>ConnStr</td><td>String</td><td>接続文字列。結果コードが0でないとき，この要素は返却されない。</td></tr>
<tr><td>Status</td><td>String</td><td>DBMSへの接続可否。connectable:接続可能, unconnectable:接続不可能。query=configuredでない，または結果コードが0でないとき，この要素は返却されない。</td></tr>
</table><br/>
</li>
</ul>
</div><p>


<H2 ID="2.6">2.6 Post /api/odbcinfos/</H2>
<div class="topic">
ODBCの情報を設定します。<br/>
<ul>
<li>リクエスト
<pre>
{
  "DbType" : "MySQL",
  "ConnStr" : "xxx",
}
</pre>
<table class="tblstyle">
<tr><td>DbType</td><td>Integer</td><td>DBMSの種別。"PostgreSQL", "MySQL", "MariaDB"の何れか。</td></tr>
<tr><td>ConnStr</td><td>String</td><td>接続文字列。</td></tr>
</table><br/>
</li>
<li>レスポンス
<pre>
{
  "Code" : 1234,
  "MsgEng" : "abc",
  "MsgJpn" : "あいう",
  "Data" : {
    "OdbcInfo" : {
      {
        "Status" : "connectable"
      }
    }
  }
}
</pre>
<table class="tblstyle">
<tr><td>Code</td><td>Integer</td><td>結果コード。0:成功(HTTPステータスコード=200)，3121:リクエストにDbType，ConnStrが含まれていない(HTTPステータスコード=400)。</td></tr>
<tr><td>MsgEng</td><td>String</td><td>英文メッセージ。結果コードが0のときは空文字が返る。</td></tr>
<tr><td>MsgJpn</td><td>String</td><td>和文メッセージ。結果コードが0のときは空文字が返る。</td></tr>
<tr><td>Data</td><td>Element</td><td>結果コードが0でないとき，この要素は返却されない。</td></tr>
<tr><td>OdbcInfo</td><td>Element</td><td>結果コードが0でないとき，この要素は返却されない。</td></tr>
<tr><td>Status</td><td>String</td><td>DBMSへの接続可否。connectable:接続可能, unconnectable:接続不可能。結果コードが0でないとき，この要素は返却されない。</td></tr>
</table><br/>
</li>
</ul>
</div><p>



</div>
</BODY>

</html>

